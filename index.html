<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de QR Codes</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Ajoutez votre CSS ici */
    </style>
</head>
<body>
    <div class="container">
        <h1>Générateur de QR Codes</h1>

        <form id="qrForm">
            <div class="form-group">
                <label for="data">Contenu du QR Code</label>
                <textarea class="form-control" id="data" rows="3" placeholder="Entrez une URL, du texte, etc."></textarea>
            </div>

            <div class="row">
                <div class="col-md-6 form-group">
                    <label for="size">Taille (px)</label>
                    <input type="number" class="form-control" id="size" value="200" min="100" max="1000">
                </div>
                <div class="col-md-6 form-group">
                    <label for="color">Couleur</label>
                    <input type="color" class="form-control" id="color" value="#000000">
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 form-group">
                    <label for="bgColor">Couleur de fond</label>
                    <input type="color" class="form-control" id="bgColor" value="#ffffff">
                </div>
                <div class="col-md-6 form-group">
                    <label for="format">Format</label>
                    <select class="form-control" id="format">
                        <option value="png">PNG</option>
                        <option value="jpeg">JPEG</option>
                    </select>
                </div>
            </div>

            <div class="text-center">
                <button type="button" class="btn btn-primary" id="downloadBtn" disabled>Télécharger</button>
            </div>
        </form>

        <div id="qrcode"></div>
    </div>

    <!-- Librairies -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

    <script>
        $(document).ready(function() {
            const qrCodeDiv = document.getElementById('qrcode');
            const downloadBtn = document.getElementById('downloadBtn');
            let qrCode = null;

            // Fonction pour générer le QR Code
            function generateQRCode() {
                const data = document.getElementById('data').value.trim();
                const size = parseInt(document.getElementById('size').value);
                const color = document.getElementById('color').value;
                const bgColor = document.getElementById('bgColor').value;

                // Vider le conteneur
                qrCodeDiv.innerHTML = '';
                downloadBtn.disabled = !data;

                if (data) {
                    // Créer un nouveau QR Code
                    qrCode = new QRCode(qrCodeDiv, {
                        text: data,
                        width: size,
                        height: size,
                        colorDark: color,
                        colorLight: bgColor,
                        correctLevel: QRCode.CorrectLevel.H
                    });
                }
            }

            // Gestion des événements
            const inputs = ['data', 'size', 'color', 'bgColor'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', generateQRCode);
                    element.addEventListener('change', generateQRCode);
                }
            });

            // Téléchargement du QR Code
            downloadBtn.addEventListener('click', function() {
                const format = document.getElementById('format').value;
                const canvas = qrCodeDiv.querySelector('canvas');

                if (canvas) {
                    const dataUrl = canvas.toDataURL(`image/${format}`);
                    const link = document.createElement('a');
                    link.download = `qrcode.${format}`;
                    link.href = dataUrl;
                    link.click();
                } else {
                    console.warn('Aucun canvas trouvé pour le téléchargement');
                }
            });

            // Tests unitaires
            function runTests() {
                console.log('Exécution des tests...');

                // Test 1: Vérification de la génération avec données vides
                document.getElementById('data').value = '';
                generateQRCode();
                console.assert(qrCodeDiv.children.length === 0, 'Test 1 échoué: QR Code généré avec données vides');

                // Test 2: Vérification de la génération avec données
                document.getElementById('data').value = 'https://example.com';
                generateQRCode();
                console.assert(qrCodeDiv.children.length > 0, 'Test 2 échoué: QR Code non généré avec données');

                // Test 3: Vérification du bouton de téléchargement
                console.assert(!downloadBtn.disabled, 'Test 3 échoué: Bouton de téléchargement non activé');

                console.log('Tests terminés');
            }

            // Exécuter les tests au chargement
            runTests();
        });
    </script>
</body>
</html>
